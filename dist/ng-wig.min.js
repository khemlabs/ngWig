"use strict";function string2array(a){return a.split(",").map(Function.prototype.call,String.prototype.trim)}function pasteHtmlAtCaret(a){var b=void 0,c=void 0;if(window.getSelection){if(b=window.getSelection(),b.getRangeAt&&b.rangeCount){c=b.getRangeAt(0),c.deleteContents();var d=document.createElement("div");d.innerHTML=a;for(var e=document.createDocumentFragment(),f=void 0,g=void 0;f=d.firstChild;)g=e.appendChild(f);c.insertNode(e),g&&(c=c.cloneRange(),c.setStartAfter(g),c.collapse(!0),b.removeAllRanges(),b.addRange(c))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(a)}var VERSION="3.0.16";angular.module("ngWig",["ngwig-app-templates"]),angular.ngWig={version:VERSION};var TABKEY=9,ENTERKEY=13;angular.module("ngWig").component("ngWig",{bindings:{content:"=ngModel",options:"<?",onPaste:"&",buttons:"@",language:"@",beforeExecCommand:"&",afterExecCommand:"&",placeholder:"@?"},require:{ngModelController:"ngModel"},templateUrl:"ng-wig/views/ng-wig.html",controller:["$scope","$element","$q","$attrs","$window","$document","$mdDialog","__env","fileService","ngWigToolbar",function(a,b,c,d,e,f,g,h,i,j){var k=this;this.addString=function(b,c){b.preventDefault(),a.$ctrl.content||(a.$ctrl.content="");var d=document.getElementById("nw-editor__src"),e=d.selectionStart,f=d.selectionEnd,g=a.$ctrl.content.substring(0,e),h=a.$ctrl.content.substring(f),i=a.$ctrl.content.substring(e,f);"\t"==c&&i.indexOf("\n")>=0&&(c="\t"+i.split("\n").join("\n\t"));var j=""+g+c+h;a.$ctrl.content=j,setTimeout(function(){d.focus(),d.selectionStart=d.selectionEnd=e+1})},this.keyDown=function(a){return a.keyCode==ENTERKEY?k.addString(a,"\n"):a.keyCode==TABKEY?k.addString(a,"\t"):void 0};var l=angular.element(b[0].querySelector("#ng-wig-editable"));this.spanish=this.language&&"spanish"==this.language,this.required="required"in d,this.isSourceModeAllowed="sourceModeAllowed"in d,this.editMode=!1,d.$observe("disabled",function(a){k.disabled=a,l.attr("contenteditable",!a)}),this.isEditorActive=function(){return l[0]===f[0].activeElement},this.toggleEditMode=function(){k.editMode=!k.editMode,e.getSelection().removeAllRanges&&e.getSelection().removeAllRanges()},this.execCommand=function(a,b){if(k.editMode)return!1;if("insertVideo"!==a&&f[0].queryCommandSupported&&!f[0].queryCommandSupported(a))throw'The command "'+a+'" is not supported';return"insertImage"==a?void i.openDialogConfirm(null,g,k.spanish?"Confirmar":"Confirm",k.spanish?"¿Desea utilizar el servicio de imágenes de Khemlabs?":"Do you want to use the Khemlabs image service?","",k.spanish?"Si":"Yes","No",function(c){return c?void i.openDialog(null,g,{path:"files/image",type:"image"},function(c){l.length&&l[0].focus(),k.beforeExecCommand({command:a,options:b}),b=h.apiDomain+"files/image/"+c,f[0].execCommand("insertHtml",!1,'<img src="'+b+'"/>'),k.afterExecCommand({command:a,options:b})}):k.fileCommand(a,b)}):"insertVideo"==a?void i.openDialogConfirm(null,g,k.spanish?"Confirmar":"Confirm",k.spanish?"¿Desea utilizar el servicio de videos de Khemlabs?":"Do you want to use the Khemlabs video service?","",k.spanish?"Si":"Yes","No",function(c){return c?void i.openDialog(null,g,{path:"files/video",type:"video"},function(c){l.length&&l[0].focus(),k.beforeExecCommand({command:a,options:b}),b=h.apiDomain+"files/video/"+c,f[0].execCommand("insertHtml",!1,'<br><br><video style="width: 560px; height: 315px" src="'+b+'"></video><br><br>'),k.afterExecCommand({command:a,options:b})}):(b=e.prompt(k.spanish?"Por favor ingrese el ID del video de youtube":"Please enter the ID of the youtube video",""),void(b&&(console.log(b),f[0].execCommand("insertHtml",!1,'<br><br><iframe style="width: 560px; height: 315px" src="https://www.youtube.com/embed/'+b+'" frameborder="0" encrypted-media" allowfullscreen=""></iframe><br><br>'),k.afterExecCommand({command:a,options:b}))))}):"createlink"===a?k.fileCommand(a,b):void k._execCommand(a,b)},this.fileCommand=function(a,b){b=e.prompt(k.spanish?"Por favor ingrese la URL":"Please enter the URL","http://"),b&&k._execCommand(a,b)},this._execCommand=function(a,b){k.beforeExecCommand({command:a,options:b});var c=f[0].getSelection().toString();"createlink"===a&&""===c?f[0].execCommand("insertHtml",!1,'<a href="'+b+'">'+b+"</a>"):f[0].execCommand(a,!1,b),k.afterExecCommand({command:a,options:b}),l.length&&l[0].focus()},this.$onInit=function(){k.toolbarButtons=j.getToolbarButtons(k.buttons&&string2array(k.buttons));var b=Boolean(k.placeholder);k.ngModelController.$render=function(){return k.ngModelController.$viewValue?l.html(k.ngModelController.$viewValue):b?l.empty():l.html()},l.bind("blur keyup change focus click",function(){!b||l.html().length&&"<br>"!==l.html()||l.empty(),k.ngModelController.$setViewValue(l.html()),a.$applyAsync()})},l.on("paste",function(a){if(d.onPaste){var b=void 0;b=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):(a.originalEvent||a).clipboardData.getData("text/plain"),a.preventDefault(),c.when(k.onPaste({$event:a,pasteContent:b})).then(function(a){pasteHtmlAtCaret(a)})}})}]}),angular.module("ngWig").provider("ngWigToolbar",function(){var a={list1:{title:"Unordered List",command:"insertunorderedlist",styleClass:"list-ul"},list2:{title:"Ordered List",command:"insertorderedlist",styleClass:"list-ol"},bold:{title:"Bold",command:"bold",styleClass:"bold"},italic:{title:"Italic",command:"italic",styleClass:"italic"},link:{title:"Link",command:"createlink",styleClass:"link"}},b=["list1","list2","bold","italic","link"],c=function(){return!!this.command&&document.queryCommandState(this.command)};this.setButtons=function(a){if(!angular.isArray(a))throw'Argument "buttons" should be an array';b=a},this.addStandardButton=function(c,d,e,f){if(!c||!d||!e)throw'Arguments "name", "title" and "command" are required';f=f||"",a[c]={title:d,command:e,styleClass:f},b.push(c)},this.addCustomButton=function(c,d){if(!c||!d)throw'Arguments "name" and "pluginName" are required';a[c]={pluginName:d,isComplex:!0},b.push(c)},this.$get=function(){return{getToolbarButtons:function(d){var e=[];return(d||b).forEach(function(b){if(!a[b])throw'There is no "'+b+'" in your library. Possible variants: '+Object.keys(a);var d=angular.copy(a[b]);d.isActive=c,e.push(d)}),e}}}}),angular.module("ngWig").component("ngWigPlugin",{bindings:{plugin:"<",execCommand:"=",editMode:"=",disabled:"=",options:"<",content:"="},controller:["$scope","$element","$compile",function(a,b,c){var d=this;this.$onInit=function(){b.replaceWith(c("<"+d.plugin.pluginName+' plugin="$ctrl.plugin"exec-command="$ctrl.execCommand"edit-mode="$ctrl.editMode"disabled="$ctrl.disabled"options="$ctrl.options"content="$ctrl.content"/>')(a))}}]}),angular.module("ngwig-app-templates",["ng-wig/views/ng-wig.html"]),angular.module("ng-wig/views/ng-wig.html",[]).run(["$templateCache",function(a){a.put("ng-wig/views/ng-wig.html",'<div class="ng-wig">\n\t<ul class="nw-toolbar">\n\t\t<li class="nw-toolbar__item" ng-repeat="button in $ctrl.toolbarButtons">\n\t\t\t<div ng-if="!button.isComplex">\n\t\t\t\t<button type="button" class="nw-button {{button.styleClass}}" title="{{button.title}}" ng-click="$ctrl.execCommand(button.command)"\n\t\t\t\t ng-class="{ \'nw-button--active\': !$ctrl.disabled && $ctrl.isEditorActive() && button.isActive() }" ng-disabled="$ctrl.editMode || $ctrl.disabled">\n\t\t\t\t\t{{ button.title }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div ng-if="button.isComplex">\n\t\t\t\t<ng-wig-plugin exec-command="$ctrl.execCommand" plugin="button" edit-mode="$ctrl.editMode" disabled="$ctrl.disabled" options="$ctrl.options"\n\t\t\t\t content="$ctrl.content"></ng-wig-plugin>\n\t\t\t</div>\n\t\t</li>\n\t\t<!--\n    -->\n\t\t<li class="nw-toolbar__item">\n\t\t\t<button type="button" class="nw-button nw-button--source" title="Edit HTML" ng-class="{ \'nw-button--active\': $ctrl.editMode }"\n\t\t\t ng-if="$ctrl.isSourceModeAllowed" ng-click="$ctrl.toggleEditMode()" ng-disabled="$ctrl.disabled">\n\t\t\t\tEdit HTML\n\t\t\t</button>\n\t\t</li>\n\t</ul>\n\n\t<div class="nw-editor-container">\n\t\t<div class="nw-editor__src-container" ng-show="$ctrl.editMode">\n\t\t\t<textarea ng-model="$ctrl.content" ng-disabled="$ctrl.disabled" id="nw-editor__src" ng-keydown="$ctrl.keyDown($event)"></textarea>\n\t\t</div>\n\t\t<div class="nw-editor" ng-class="{ \'nw-disabled\': $ctrl.disabled }">\n\t\t\t<div id="ng-wig-editable" class="nw-editor__res" ng-class="{\'nw-invisible\': $ctrl.editMode}" ng-disabled="$ctrl.disabled"\n\t\t\t contenteditable placeholder="{{$ctrl.placeholder}}">\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>')}]);